<html>
<head>
	<title>locationDetail</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>
	<!-- Bootstrap and JQuery -->
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">

	<!--Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Fredericka+the+Great" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

	<!--CUSTOM CSS and JS -->
	<link rel="stylesheet" type="text/css" href="../assets/css/style.css">
</head>

<body>
<!------------------ HEADER ------------------>
	<header class="mb-4">
		<div class="container-fluid fixed-top" style="padding:0; background-color:#FEFAFA">
			<div class="col text-center" id="fadeout">
				<img class="img-fluid" src="../assets/img/logo2.png" style="max-height:120px" />
			</div>
			<nav class="navbar navbar-expand-lg" style="margin:0">
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="margin:auto">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
					<ul class="navbar-nav" style="margin:auto">
						<li class="nav-item"><a class="nav-link navigation-text" href="../index.html">Home</a></li>
						<li class="nav-item"><a class="nav-link navigation-text" href="whoweare.html">Who We Are</a></li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle navigation-text" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								Our offer
							</a>
							<div class="dropdown-menu text-center" aria-labelledby="navbarDropdown">
								<a class="dropdown-item navigation-text" href="services.html">Services</a>
								<a class="dropdown-item navigation-text" href="people.html">People</a>
								<a class="dropdown-item navigation-text" href="locations.html">Locations</a>
							</div>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle navigation-text" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								News &amp; Events
							</a>
							<div class="dropdown-menu text-center" aria-labelledby="navbarDropdown">
								<a class="dropdown-item navigation-text" href="#">News</a>
								<a class="dropdown-item navigation-text" href="#">Events</a>
							</div>
						</li>
						<li class="nav-item"> <a class="nav-link navigation-text" href="contactus.html">Contacts</a> </li>
					</ul>
				</div>
			</nav>
		</div>
	</header>
	<nav aria-label="breadcrumb">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="locations.html">Locations</a></li>
			<li class="breadcrumb-item active" aria-current="page" id="breadcrumbName"><!--Fill with name--></li>
		</ol>
	</nav>

	<!------------------ CONTENT ------------------>
	<div class="container-fluid" id="content-wrapper">

		<!------------------ PRESENTATION IMAGE ------------------>
		<div  class="row">
			<div class ="col-lg-8 m-auto text-center">
				<img src="#" class="presentation-image" alt="" id="locImg">
				<div class="opaque_line_text" id="locName">
					<!--Fill with name-->
				</div>
			</div>
		</div>


		<!---------------- LOCATION DESCRIPTION ---------------->
		<div class="col-lg-10 p-0 mx-auto">

			<blockquote class="mx-auto text-center location_quote mb-5" id="locQuote" style="white-space: pre-wrap">
				<!--Fill with quote-->
			</blockquote>

			<div class="d-flex flex-row flex-wrap">
				<!------------------ Text Description ------------------>
				<div class="col-md-7 align-self-center order-1 ml-auto" id="locDescription">
					<!--Fill with description-->
				</div>

				<!------------------ MAPS ------------------>
				<div class="col-md-5 align-self-center order-12 order-md-2 mr-auto p-0">

					<h4 class="text-center" style="font-size: 1.7em;">Find Us</h4>

					<!--filled with dynamic Google Maps' Pointer-->
					<div class="" id="map" style="width:100%; height: 300px; background-color: yellow"></div>
					
					<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDb2UR8QOXPqDDCeMDyzk37TL86jZZdzcc&callback=myMap"></script>

					<div class="contants">
						<h5 class="text-center  mt-3 mb-0">Reach Us Out</h5>
						<ul class="stylish-list ml-3">
							<li id="locAddr"> 
								<!--Fill with address, city, CAP-->
							</li>
							<li>
								<a href="#" id="locPhone"> <!--Fill with phone--> </a>
							</li>
							<li>
								<a href="#" id="locMail"> <!--Fill with mail--> </a>
							</li>
						</ul>
					</div>
				</div>

				<hr class="division_line order-3 my-5">

				<!------------------ Carousel ------------------>
				<div class="col-12 order-4 m-auto" style="min-height: 515px;" id="carousel">
					<div class="row m-0">
						<div class="col-12 p-0">
							<div id="carousel_location" class="carousel slide" data-ride="carousel">
								<ol class="carousel-indicators" id="carousel-indicators">
									<!--add dinamically indicators-->
								</ol>
								<div class="carousel-inner" id="carousel-inner">
									<!--add dinamically slides-->
								</div>
								<a class="carousel-control-prev" href="#carousel_location" role="button" data-slide="prev">
									<span class="carousel-control-prev-icon" aria-hidden="true"></span>
									<span class="sr-only">Previous</span>
								</a>
								<a class="carousel-control-next" href="#carousel_location" role="button" data-slide="next">
									<span class="carousel-control-next-icon" aria-hidden="true"></span>
									<span class="sr-only">Next</span>
								</a>
							</div>
						</div>
						<!--area riempita dall'header del carosello da jQuery-->
						<div class="new-caption-area col mt-3 mb-0 text-center"></div>
					</div>
					<!--only visible till md-->
					<hr class="division_line my-3 d-md-none">
				</div>
			</div>


			<hr class="division_line my-5" id="division_line1">

			<!-----SERVICES CATEGORY----->
			<div class="col-lg-10 m-auto" id="servicesGroup">

				<!--Advisory-->
				<div class="serviceContainer d-none" id="Advisory">
					<div class="pl-3 mt-3" style="border-left: 15px solid blue" id="AdvisoryDescription">
						<h2>Advisory</h2>
						<img class="rounded_icon" src="../assets/img/icons/book.png">
						<p>The goal of an advisory is to help students figure out who they are, where they’re headed, and how they’re going to get there. Through an advisory system, each student has an adult who knows them and helps them navigate high school so that they leave with a meaningful, personalized plan and are prepared for postsecondary options.</p>
					</div>

					<ul class="stylish-list pl-5" id="AdvisoryList">
						<!---fill with services--->
					</ul>
				</div>

				<!--CHILDREN-->
				<div class="serviceContainer d-none" id="Children">
					<div class="pl-3 mt-5" style="border-left: 15px solid green" id="ChildrenDescription">
						<h2>Children</h2>
						<img class="rounded_icon" src="../assets/img/icons/child.png">
						<p>Children are the ones who are very vital for deciding how the world is gonna be after some years. So if one can do some good in the life of a child then there can be change, atleast a slightest change, in the world to come. And if most of them think on same lines then we can hope of a better future ahead. The main component which decides how the person is going to be in the future or the present is the amount of education he/she has within them.</p>					
					</div>
					
					<ul class="stylish-list pl-5" id="ChildrenList">
						<!---fill with services--->
					</ul>
				</div>
				

				<!--YOUNG ADULTS-->
				<div class="serviceContainer d-none" id="YoungAdults">
					<div class="pl-3 mt-5" style="border-left: 15px solid red" id="YoungAdultsDescription">
						<h2>Young Adults</h2>
						<img class="rounded_icon" src="../assets/img/icons/young_adult.png">
						<p>Growing up, we learn to resent being told what to do. It’s almost instinctive. If it’s not our parents, it’s our teachers, if it’s not our teachers it’s that ever present “society” that tells us we aren’t old enough to make decisions for ourselves so we’re to follow their rules until we’re old enough to “know better”.</p>
					</div>

					<ul class="stylish-list pl-5" id="YoungAdultsList">
						<!---fill with services--->
					</ul>
				</div>
			</div>
		</div>
	</div>

	<!------------------ FOOTER ------------------>

	<footer>
		<div class="footer_content">
			<div class="container-fluid">
				<div class="row">
					<div class="col-10 col-md-6 d-flex flex-column flex-md-row text-center align-items-center nav-itemfooter mx-auto mb-3" >
						<a style="color: white; padding-left: 10px; padding-right: 10px" href="../index.html">Home</a>
						<a style="color: white; padding-left: 10px; padding-right: 10px" href="#">Privacy</a>
						<a style="color: white; padding-left: 10px; padding-right: 10px" href="#">Volunteer</a>
						<a style="color: white; padding-left: 10px; padding-right: 10px" href="#">FAQ</a>
						<a style="color: white; border-right: none; padding-left: 10px; padding-right: 10px" href="#">Help Us!</a>
					</div>
					<div class="col-10 col-md-4 mx-auto mb-3">
						<div class ="social">
							<div class="a2a_kit a2a_kit_size_32 a2a_default_style d-flex justify-content-center" style="padding-top: 10px">
								<a class="a2a_button_facebook" href="https://www.facebook.com"></a>
								<a class="a2a_button_twitter" href="https://www.twitter.com" style="margin-left: 10px"></a>
								<a class="a2a_button_google_plus" href="https://www.plus.google.com" style="margin-left: 10px"></a>
								<a class="a2a_button_email" style="margin-left: 10px"></a>
							</div>
							<script async src="https://static.addtoany.com/menu/page.js"></script>
						</div>
					</div>
					<div class=" col-10 col-md-2 mx-auto">
						<button href="#" type="button" class="btn donate-btn d-block mx-auto mb-3">
							donate
						</button>
					</div>
				</div>
			</div>
		</div>
	</footer>
	
	<!---------------------------------------------------->
	<!------------------ DYNAMIC SCRIPT ------------------>
	<!---------------------------------------------------->
	
	<script src="../assets/js/script.js"></script>
	<script type="text/javascript">
		
		'use strict';
		
		jQuery(document).ready(function() {
			
			var locationID = getAllUrlParams().id;
			
			
			//first of all basic location data are fetched in order to fill all the general attributes
			fetch('/locations/' + locationID)
				.then(response => response.json())
				.then(function(locationData) {
					fillLocationData(locationData);
			});
			
			// location slides, with picture-source and texts are fetched.
			// Carousel, empty at the beginning is filled with data
			fetch('/locations/' + locationID + "/slide")
				.then(response => response.json())
				.then(function(slides){
					createCarousel(slides);
			});
			
			// location services, with typology and overview are fetched.
			// data is groupped by typology, and each services fills the corresponding area
			fetch('/locations/' + locationID + '/services')
				.then(response => response.json())
				.then(function(serviceList){
					//typologies of services operated in this location
					let typoList = serviceList
												.map(serv => serv.typology) //extract only typology
												.filter((elem, index, self) => index == self.indexOf(elem)) //delete duplicates
												.map(type => type.replace(/\s+/g, '')); //delete spaces

					//each 'typology area' is maped to fill it with the correct 'service overview'
					typoList.map(addOverview, serviceList); //serviceList is passed via this attribute
			});
			
			
			
			function fillLocationData(location){
				document.title = location[0].name;
				$('#breadcrumbName').text(location[0].name);
				
				$('#locImg').attr({
					src: location[0].picture + 'cover.jpg',
					alt: 'Location' + location[0].id
				});
				
				$('#locName').text(location[0].name);
				$('#locQuote').text(location[0].quote);
				
				location[0].overview.split('\n')
					.forEach(function(par){
						$('#locDescription').append(`
							<p>${par}</p>
						`);
					});
				
				$('#locAddr').text(location[0].address);
				$('#locPhone').text(location[0].phone);
				$('#locMail').text(location[0].mail);
				
				var coord = location[0].coordinates.split(',');
				myMap(coord);
			};
			

			
			/**in case fetched 'slides' Array is empty the Carousel is hided
			 * in the other case for every slide a <li> with the relative Bootstrap control class is created
			 */
			function createCarousel(data){
				if(data.length > 0){
					for(var i=0; i<data.length; i++){
						$('#carousel-indicators').append(
							`<li data-target="#carousel_location" data-slide-to=" ` + i + `"></li>`
						);
						$('#carousel-indicators div').first().addClass("active");
						
						addCarouselData(data);
					}
				}
				else{
					//hide carousel
					$('#carousel').hide();
					//hide one of the division lines
					$('#division_line1').hide();
				}				
			};
		
			/**this function does something only if fetched 'slides' Array is not empty
			 * For every slide a <div>, with content and Bootstrap control classes is addes
			 *
			 * Since our carousel captions are placed in a <div> external to the carousel itself,
			 * the first caption in the array has to be placed during carousel population.
			 * When the pages is fully loaded, it will a matter of Bootstrap move the captions. (see /assets/script.js)
			 */
			function addCarouselData(slides){
				
					slides.forEach(function(elem){
						$('#carousel-inner').append(`
							<div class="carousel-item">
								<img class="d-block w-100" src="${elem.source}" alt="slide">
								<div class="carousel-caption">
									<blockquote class="carousel_quote">
										<h4>${elem.header}</h4>
										<p>${elem.description}</p>
									</blockquote>
								</div>
							</div>
						`)}	
					);
					$('#carousel-inner div').first().addClass("active");

					//add first carousel caption in other div
					$('.carousel').carousel();
					
					
					var caption = $('div.carousel-item:nth-child(1) .carousel-caption');
					//copying the caption in the new area
					$('.new-caption-area').html(caption.html());
					
					//caption in carousel is hidden, since it has been copied in a new div
					caption.css('display', 'none');
				
			};
			
			//Google Maps simple function, in order to have a placeholder of our location in the map
			function myMap(coord) {
				var latlng = new google.maps.LatLng(coord[0],coord[1]);
				var mapOptions = {
					center: latlng,
					zoom: 15,
					mapTypeId: google.maps.MapTypeId.map
				}
				var map = new google.maps.Map(document.getElementById("map"), mapOptions);
				var marker = new google.maps.Marker({
					position: latlng,
					map: map,
					title: 'Noi siamo qui'
				});
			};
			
			
			/* "dinamically change carousel caption on other Div*/
			$(function() {
				$(".carousel").on('slide.bs.carousel',function (evt) {
					var caption = $('div.carousel-item:nth-child(' + ($(evt.relatedTarget).index() + 1) + ') .carousel-caption');
					$('.new-caption-area').html(caption.html());
					caption.css('display', 'none');
				});
			});
			
			
			
			function addOverview(serviceType){
				let serviceList = this; //service list passed via 'this' argument
				serviceList.forEach(function(service){
					//spaces are deleted from input service typology in order to match with div Id, which has no spaces
					var serviceName_NoSpaces = service.typology.replace(/\s+/g, ''); //delete spaces
					
					if(serviceName_NoSpaces === serviceType){
						$('#' + serviceType).removeClass('d-none');
						$('#' + serviceType + 'List').append(`
							<li class="my-2 serviceOverview">
								<a class="d-block" data-toggle="collapse" href="#collapseService_${service.id}" role="button" aria-expanded="false">
									${service.name}
								</a>
								<div class="collapse" id="collapseService_${service.id}">
									<div class="p-1">
										${service.overview.split(".")[0] + "." + service.overview.split(".")[1] + "..."}
										<a href="serviceDetail.html?id=${service.id}" class="button redirect-btn ml-auto mr-3 my-1">Read More...</a>
									</div>
								</div>
							</li>
						`);
					}
				});
			};
		});

	</script>
</body>
</html>
